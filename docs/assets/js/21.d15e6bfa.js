(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{151:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"centos-mysql5-6数据库安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos-mysql5-6数据库安装配置","aria-hidden":"true"}},[s._v("#")]),s._v(" Centos MySQL5.6数据库安装配置")]),t("h2",{attrs:{id:"必要软件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#必要软件","aria-hidden":"true"}},[s._v("#")]),s._v(" 必要软件")]),t("ul",[t("li",[s._v("SSH")]),t("li",[s._v("mysql-5.6.33-linux-glibc2.5-x86_64.tar.gz安装包")])]),t("h2",{attrs:{id:"配置信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置信息","aria-hidden":"true"}},[s._v("#")]),s._v(" 配置信息")]),t("ol",[t("li",[s._v("新建Linux用户组：mysql")]),t("li",[s._v("新建Linux用户：mysql 隶属于mysql组")]),t("li",[s._v("Localhost登陆信息：\n"),t("ul",[t("li",[s._v("账户：root")]),t("li",[s._v("安装目录：/usr/local/mysql")]),t("li",[s._v("数据和log所在目录：/home/mysql/{data,log}")])])])]),t("h2",{attrs:{id:"配置过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置过程","aria-hidden":"true"}},[s._v("#")]),s._v(" 配置过程")]),t("ol",[t("li",[t("p",[s._v("新建软件安装包目录，并下载MySql发行版解压包")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mkdir softwares \ncd softwares\nwget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.20-linux-glibc2.12-x86_64.tar.gz\n")])])])]),t("li",[t("p",[s._v("安装编译工具和依赖包，在CentOS中，用yum包管理工具安装，ubuntu中使用apt安装。")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yum -y install make gcc-c++ cmake \nyum -y install bison-devel ncurses-devel libaio\n")])])])]),t("li",[t("p",[s._v("删除CentOS默认安装的mariadb")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("rpm -qa | grep mariadb\nrpm -e --nodeps `rpm -qa|grep mariadb `\n")])])])]),t("li",[t("p",[s._v("新建mysql用户组和msyql用户")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("groupadd mysql\nuseradd -g mysql mysql\n")])])])]),t("li",[t("p",[s._v("解压文件")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("tar zxvf /root/softwares/mysql-5.7.20-linux-glibc2.12-x86_64.tar.gz -C /usr/local/\nmv /usr/local/mysql-5.7.20-linux-glibc2.12-x86_64 /usr/local/mysql\n")])])])]),t("li",[t("p",[s._v("新建my.cnf配置文件")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("vim /etc/my.cnf\n")])])])]),t("li",[t("p",[s._v("复制启动文件")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cp /usr/local/mysql/support-files/mysql.server /etc/rc.d/init.d/mysqld```\n")])])])]),t("li",[t("p",[s._v("修改mysqld的执行权限")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("chmod +x /etc/rc.d/init.d/mysqld\n")])])])]),t("li",[t("p",[s._v("将mysqld服务加入到系统服务")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("chkconfig --add mysqld\n")])])])]),t("li",[t("p",[s._v("写入以下内容：")]),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{attrs:{class:"token selector"}},[s._v("[mysqld]")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("server_id")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v("01")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("port")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 3306")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("user")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" mysql")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("character-set-server")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" utf8")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("default_storage_engine")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" innodb")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("log_timestamps")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" SYSTEM")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("socket")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /tmp/mysql.sock")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("basedir")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /usr/local/mysql")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("datadir")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /home/mysql/mysql/data")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("pid-file")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /home/mysql/mysql/data/mysql.pid")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("max_connections")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 500")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("max_connect_errors")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 220")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("table_open_cache")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 1024")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("max_allowed_packet")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 128M")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("open_files_limit")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 65535")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_buffer_pool_size")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 1024M")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_file_per_table")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 1")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_write_io_threads")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 4")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_read_io_threads")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 4")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_purge_threads")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 2")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_flush_log_at_trx_commit")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 1")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_log_file_size")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 512M")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_log_files_in_group")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 2")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_log_buffer_size")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 16M")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_max_dirty_pages_pct")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 80")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_lock_wait_timeout")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 30")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("innodb_data_file_path")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v("ibdata1:1024M:autoextend")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("log_error")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /home/mysql/mysql/log/mysql-error.log ")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("slow_query_log")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 1")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("long_query_time")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" 1 ")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("slow_query_log_file")]),s._v(" "),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" /home/mysql/mysql/log/mysql-slow.log")]),s._v("\n"),t("span",{attrs:{class:"token constant"}},[s._v("sql_mode")]),t("span",{attrs:{class:"token attr-value"}},[t("span",{attrs:{class:"token punctuation"}},[s._v("=")]),s._v("NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES")]),s._v("\n")])])])]),t("li",[t("p",[s._v("切换到mysql用户")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("su - mysql\n")])])])]),t("li",[t("p",[s._v("新建日志文件夹")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ mkdir -p ./mysql/{data,log}\n")])])])]),t("li",[t("p",[s._v("设置目录权限（可能需要切换到root帐户或者给mysql设置密码后sudo）")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("chown -R mysql:mysql /usr/local/mysql ./mysql\n")])])])]),t("li",[t("p",[s._v("设置环境变量")])])]),t("ul",[t("li",[s._v("打开.bashrc"),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("vim .bashrc\n")])])])]),t("li",[s._v("添加以下内容"),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("export")]),s._v(" MYSQL_HOME"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),t("span",{attrs:{class:"token string"}},[s._v('"/usr/local/mysql"')]),s._v("\n"),t("span",{attrs:{class:"token function"}},[s._v("export")]),s._v(" PATH"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),t("span",{attrs:{class:"token variable"}},[s._v("$PATH")]),t("span",{attrs:{class:"token keyword"}},[s._v(":")]),t("span",{attrs:{class:"token variable"}},[s._v("$MYSQL_HOME")]),s._v("/bin\n")])])])])]),t("ol",{attrs:{start:"14"}},[t("li",[t("p",[s._v("执行")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v(" .bashrc\n")])])])]),t("li",[t("p",[s._v("初始化数据库")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysqld --initialize --user"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n")])])]),t("p",[s._v("执行上面的命令初始化数据库，mysql会自动为数据库root用户设置随机密码")]),t("blockquote",[t("p",[s._v("如果遇到如错误，警示data文件夹不为空。因为初始化时，data文件夹必须为空，确认data里没有重要数据后可以直接删除data文件夹和log文件夹里的文件 ，再执行初始化命令。\n执行以下代码找到自动设置的随机密码，最后一个匹配的就是最新的密码。")])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{attrs:{class:"token string"}},[s._v("'password .* generated'")]),s._v(" ~/mysql/log/mysql-error.log\n")])])])]),t("li",[t("p",[s._v("打开数据库服务")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("service")]),s._v(" mysqld start\n")])])])]),t("li",[t("p",[s._v("用MySql 客户端登陆")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql -uroot –p’默认密码’\n")])])]),t("p",[s._v("如果再登陆后执行sql语句时遇到：ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement错误，则需要修改默认密码，实际部署应该设置比较复杂的密码。\n解决办法")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" alter user "),t("span",{attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),t("span",{attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" identified by "),t("span",{attrs:{class:"token string"}},[s._v("'newpassword*2018example'")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" flush privileges"),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n")])])]),t("p",[s._v("或者")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("mysql"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" password"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("password"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{attrs:{class:"token string"}},[s._v('"newpassword*2018example"')]),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" flush privileges"),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),t("h2",{attrs:{id:"导入数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入数据","aria-hidden":"true"}},[s._v("#")]),s._v(" 导入数据")]),t("p",[s._v("可以使用Navcat访问数据库直接或者使用linux的scp工具上传sql备份数据到服务器，用mysql恢复sql文件到数据库。\n以下操作需要转到mysql用户，\n"),t("code",[s._v("shell su - mysql")]),s._v("\n增加数据库远程访问权限。(用navcat链接会用上/直接用服务器上的mysql操作可以跳过)")]),t("ol",[t("li",[t("p",[s._v("登陆mysql")]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ mysql -uroot -p"),t("span",{attrs:{class:"token string"}},[s._v("'newpassword*2018example'")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \nmysql"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("use mysql"),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" update user "),t("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" host"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),t("span",{attrs:{class:"token string"}},[s._v("'%'")]),s._v(" where user"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),t("span",{attrs:{class:"token string"}},[s._v("'root'")]),t("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),t("li",[t("p",[s._v("还原数据库。\n用navcat链接数据库。新建example数据库并导入备份数据。\n由于暂时没有打开3306端口，无法使用软件导入，暂时使用mysql导入")])]),t("li",[t("p",[s._v("新建example数据库")]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mysql> create database if not exists example default charset utf8 COLLATE utf8_general_ci;\n")])])])]),t("li",[t("p",[s._v("查看数据库")]),t("div",{staticClass:"language-mysql> show databases; extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| example            |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n5 rows in set (0.00 sec)\n")])])]),t("p",[s._v("存在以上数据库，example创建成功，现在导入数据库备份")]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mysql> source ~/backpack/example.sql\n")])])]),t("p",[s._v("如果没有出现错误则成功导入备份数据。")])]),t("li",[t("p",[s._v("防火墙配置\n因为需要远程访问数据库，需要开启3306端口,也可以修改默认端口.")])])])])}],!1,null,null,null);a.default=e.exports}}]);